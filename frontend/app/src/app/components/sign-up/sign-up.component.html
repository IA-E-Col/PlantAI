<div class="height-90" id="container">
  <!-- Image de fond -->
  <img src="assets/back.jpg" style="position: absolute;" class="image" alt="Image de fond">
  
  <div class="h-100">
    <div class="d-flex justify-content-center align-items-center h-100">
      
      <!-- Colonne de gauche : Slogan & Image -->
      <div class="col-md-6 d-md-block d-none col-12 bg-grad h-100">
        <div class="d-flex flex-column align-items-center justify-content-center h-100">
          <div class="text-center">
            <h1 class="text-white display-5">Bienvenue sur PlantAI</h1>
          </div>
          <div class="mt-2 text-center">
            <p class="text-light fs-4 font-light">Votre solution pour gérer vos herbiers</p>
          </div>
          <img src="assets/plant.svg" class="w-75 h-75 opacity-50" alt="Image de plante">
        </div>
      </div>
      
      <!-- Colonne de droite : Formulaire d'inscription (ou formulaire MFA si nécessaire) -->
      <div class="col-md-6 mb-5 mt-5 d-md-flex flex-column justify-content-center align-items-center h-100">
        
        <!-- En-tête pour les appareils mobiles -->
        <div class="d-md-none d-flex justify-content-center align-items-center mb-3 mt-5">
          <div class="rounded-circle bg-green d-inline-block p-2">
            <img src="assets/plant.svg" width="50" height="50" alt="Logo">
          </div>
          <p class="fs-4 font-light p-0 mb-0 mt-0 ms-4">
            Bienvenue sur <span class="text-green fs-4 font-light">PlantAI</span>
          </p>
        </div>
        
        <div class="mb-3 text-center mt-3">
          <h1 class="text-green underlined">Inscription</h1>
        </div>
        
        <!-- Formulaire d'inscription (affiché si MFA n'est pas activé) -->
        <div class="container" style="margin-top:160px" *ngIf="!authResponse?.mfaEnabled">
          <!-- Bloc de message -->
          <div *ngIf="message" [ngClass]="{'error-message-panel': isError, 'success-message-panel': !isError}">
            <div class="message-icon">{{ isError ? '&#10006;' : '&#10004;' }}</div>
            <div class="message-text">{{ message }}</div>
          </div>
          
          <form #registerForm="ngForm" (ngSubmit)="registerUser()" class="form-login p-2 d-flex col-12 col-sm-12 col-md-6">
            <div class="d-flex align-items-start flex-column mb-4 w-100">
              <label for="prenom">Prénom</label>
              <input required minlength="4" id="prenom" name="prenom" type="text" placeholder="Prénom" [(ngModel)]="signupRequest.prenom">
            </div>
            <div *ngIf="registerForm.controls['prenom']?.invalid && (registerForm.controls['prenom']?.dirty || registerForm.controls['prenom']?.touched)" class="text-danger mt-1">
              <span *ngIf="registerForm.controls['prenom']?.errors?.['required']">Le prénom est requis.</span>
              <span *ngIf="registerForm.controls['prenom']?.errors?.['minlength']">Le prénom doit contenir au moins 4 caractères.</span>
            </div>
            
            <div class="d-flex align-items-start flex-column mb-4 w-100">
              <label for="nom">Nom</label>
              <input required minlength="4" id="nom" name="nom" type="text" placeholder="Nom" [(ngModel)]="signupRequest.nom">
            </div>
            <div *ngIf="registerForm.controls['nom']?.invalid && (registerForm.controls['nom']?.dirty || registerForm.controls['nom']?.touched)" class="text-danger mt-1">
              <span *ngIf="registerForm.controls['nom']?.errors?.['required']">Le nom est requis.</span>
              <span *ngIf="registerForm.controls['nom']?.errors?.['minlength']">Le nom doit contenir au moins 4 caractères.</span>
            </div>
            
            <div class="d-flex align-items-start flex-column mb-4 w-100">
              <label for="email">E-mail</label>
              <input id="email" name="email" type="text" placeholder="E-mail" pattern=".+@gmail\.com$" required [(ngModel)]="signupRequest.email">
            </div>
            <div *ngIf="registerForm.controls['email']?.invalid && (registerForm.controls['email']?.dirty || registerForm.controls['email']?.touched)" class="text-danger mt-1">
              <span *ngIf="registerForm.controls['email']?.errors?.['pattern']">
                Adresse e-mail invalide. Doit se terminer par "gmail.com".
              </span>
              <span *ngIf="registerForm.controls['email']?.errors?.['required']">
                L'e-mail est requis.
              </span>
            </div>
            
            <div class="d-flex align-items-start flex-column mb-4 w-100">
              <label for="password">Mot de passe</label>
              <input id="password" name="password" type="password" placeholder="Mot de passe" required minlength="8" pattern="^(?=.*\d).{8,}$" [(ngModel)]="signupRequest.password">
            </div>
            <div *ngIf="registerForm.controls['password']?.invalid && (registerForm.controls['password']?.dirty || registerForm.controls['password']?.touched)" class="text-danger mt-1">
              <span *ngIf="registerForm.controls['password']?.errors?.['minlength']">
                Le mot de passe doit contenir au moins 8 caractères.
              </span>
              <span *ngIf="registerForm.controls['password']?.errors?.['pattern']">
                Le mot de passe doit contenir au moins un chiffre.
              </span>
              <span *ngIf="registerForm.controls['password']?.errors?.['required']">
                Le mot de passe est requis.
              </span>
            </div>
            
            <!-- Champ de confirmation du mot de passe -->
            <div class="d-flex align-items-start flex-column mb-4 w-100">
              <label for="confirmPassword">Confirmer le mot de passe</label>
              <input id="confirmPassword"
                     name="confirmPassword"
                     type="password"
                     placeholder="Confirmer le mot de passe"
                     required
                     minlength="8"
                     [(ngModel)]="confirmPassword">
            </div>
            <div *ngIf="(registerForm.submitted || registerForm.controls['confirmPassword']?.touched) && signupRequest.password !== confirmPassword"
                 class="text-danger mt-1">
              <span>Les mots de passe ne correspondent pas.</span>
            </div>
            
            <!-- Liste déroulante pour le département -->
            <div class="d-flex align-items-start flex-column mb-4 w-100">
              <label for="department">Département</label>
              <select id="department" name="department" required [(ngModel)]="signupRequest.departement">
                <option value="" disabled selected>Sélectionnez un département</option>
                <option *ngFor="let dep of departments" [value]="dep">{{ dep }}</option>
              </select>
            </div>
            
            <div class="d-flex align-items-start flex-column mb-4 w-100">
              <label for="image">Image de profil</label>
              <input id="image" type="file" name="file" (change)="onFileSelected($event)" class="form-control">
              <img *ngIf="previewImage" [src]="previewImage" class="mt-2 rounded" width="100" height="100" alt="Aperçu">
            </div>
            
            <!-- Case à cocher 2FA à la fin du texte -->
            <div class="d-flex align-items-center mb-4 w-100">
              <label for="rememberMe" class="me-2">
                Activer la 2FA (Authentification à deux facteurs)
              </label>
              <input id="rememberMe" name="rememberMe" type="checkbox" [(ngModel)]="signupRequest.mfaEnabled">
            </div>
            
            <div class="d-flex justify-content-end">
              <p class="fs-5 font-light text-black">
                Vous avez déjà un compte ? 
                <span>
                  <a class="text-green fs-5 underlined font-light" [routerLink]="['/login']">Se connecter</a>
                </span>
              </p> 
            </div>
            <button class="btn btn-green p-2 w-100" [disabled]="registerForm.invalid" type="submit">S'inscrire</button>
          </form>
        </div>
        
        <!-- Formulaire MFA (affiché si MFA est activé) -->
        <div class="container" *ngIf="authResponse?.mfaEnabled">
          <div class="success-message-panel" *ngIf="message">
            <div class="success-icon">&#10004;</div>
            <div class="success-message">{{ message }}</div>
          </div>
          <h2>Configurer l'authentification à deux facteurs</h2>
          <div class="qr-code">
            <img [src]="authResponse.secretImageUri" alt="QR Code">
          </div>
          <div class="d-flex align-items-start flex-column mb-4 w-100">
            <label for="validationCode">Saisissez le code de validation à 6 chiffres généré par l'application</label>
            <input type="text" id="validationCode" name="validationCode" required [(ngModel)]="otpCode">
          </div>
          <button type="button" (click)="verifyTfa()" [class.button-disabled]="otpCode.length < 6">Vérifier le code</button>
        </div>
        
        <!-- Loader -->
        <div *ngIf="isLoading" class="loader-overlay">
          <div class="spinner"></div>
        </div>
        
      </div> <!-- fin colonne droite -->
    </div> <!-- fin conteneur flex -->
  </div> <!-- fin h-100 -->
</div>
